> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [blog.csdn.net](https://blog.csdn.net/taylor_2019/article/details/108665272)

```
    降噪产品开发过程的一个难题是主动降噪回路设计，其中重要的是如何进行根据耳机设计匹配的滤波器实现ANC降噪。

```

ANC 耳机从研发到量产全过程主要有如下过程：  
**ID 设计——> 传递参数测量——> 滤波器搭建仿真——>ANC 降噪效果验证**  
无论怎么复杂的 ANC 耳机，都是由核心的 3 部分组成，耳腔、麦克风、扬声器，所以一个完整的设计过程是由三步组成：  
在这个过程中**传递参数测量**是 ANC 设计的重要第一步，主要需要完成如下工作：  
1、获得各部件参数；  
2、计算目标曲线：被动降噪曲线、降噪 mic 曲线、喇叭曲线；

> 在正式开始制作一款主动降噪耳机之前，我们需要特殊的音频设备。首先是用于测量频率响应和相位响应的**音频测量系统**。可选用的音频设备有 Audio  
> Precision、BrüelKjaer、Soundcheck 等。除了音频测量系统，**人耳模拟装置**也是重要的一部分，如来自 Head  
> Acoustics、BrüelKjaer 或 GRAS 的 IEC711（入耳式主动降噪产品）或 HeadTorso 模拟器（头戴式及耳罩式产品）。人耳模拟装置可在量测耳机特性时用于模拟人耳响应。这些人工耳集成了高度精确的麦克风，能够测量到人戴耳机时真实听到的声音，为了测试的参数与人耳的实际听感相接近。另外还需要一个**扬声器**，用于测量耳机的被动衰减特性，这是[滤波器](https://so.csdn.net/so/search?q=%E6%BB%A4%E6%B3%A2%E5%99%A8&spm=1001.2101.3001.7020)设计的一部分。此扬声器应该是双向式扬声器，且最好是同轴双向式扬声器，以保证从扬声器到耳机的高频与低频的传输距离相等。最后需要**降噪芯片评估板**，它包含了所有必要的 ** _连接器_**和**前置放大器__，使性能测试过程尽可能流畅地进行。
> 
> 为什么要对耳机进行性能测试？  
> 每个耳机的声学表现都不尽相同。原因很简单，因为耳机采用不同的组件，如拥有不同阻抗和传递系数的扬声器。且每一款耳机的弹性衬垫以及前后声腔也都不一样。  
> 要制作主动降噪耳机，了解耳机的特性很重要，这样才能获得良好的降噪性能。主动降噪前馈耳机使用 ECM 麦克风捕捉耳机外部的噪音。电子线路会产生一个抗噪反信号，然后通过扬声器播放出来。理论上，ANC 回路是一个简单的反相电路，但事实并非如此。由于耳机的不同组件会影响频率响应和相位响应，简单的反相无法令 ANC 达到性能要求。为了解耳机在增益和相位方面的表现，ANC 耳机的性能测试显得尤为重要。

**ANC 定参**  
何为定参，定参就是上文中传递函数的测量；  
当麦克风型号，扬声器型号以及耳机腔体（前腔、后腔）结构、密封方式确定后，测量此系统各部件的传递函数，以便于设计滤波器；  
ps：需要注意的是设计一款降噪滤波器适用于这个耳机腔体，也仅仅适用于这个腔体，腔体结构、元器件选型一旦改变，滤波器要重新进行设计；  
下面将以一款 FF 前馈式降噪耳机为例进行 ANC 定参的传递参数确定测试。为了得到理想的 ANC 滤波曲线，我们必须采用第一段提到的设备进行三项测量，测量前进行噪声源校准；  
![](https://img-blog.csdnimg.cn/20200918164956899.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3RheWxvcl8yMDE5,size_16,color_FFFFFF,t_70#pic_center)

1.  第一项测量是被动衰减测量，噪声源经过耳机被动降噪后的声音，需要测试其频响‘FR(1)’及相位 PH(1)；  
    方法为用同轴扬声器或仿真嘴发出 - 20dBV 20Hz-22kHz 的扫频声波，并测量到达人耳的声波。到达人耳的声波可使用人耳模拟器内部的麦克风来测量。这样，我们测到耳机自身引起的噪声衰减，即被动衰减。
2.  第二项是降噪麦克风的部件参数，需要测试其频响‘FR(2)’及相对相位‘PH(2)’。同样，正弦扫频信号通过同轴扬声器播放出来，并由 ANC 麦克风收集 (麦克风引线出来接入供电模块）。
3.  第三项是耳机扬声器的部件参数，需要测试其频响‘FR(3) 及相对相位‘PH(3)’;  
    方法为 20Hz 至 22kHz 的扫频信号由耳机内部的扬声器发出，供测试使用的人工头内的麦克风收集到该信号。该项检测测量了降噪信号通过扬声器播出时的传递函数，以及信号是如何被人耳接收的。相位对这三项测量都十分重要，如果扬声器播出的抗噪信号与从环境进入人耳的噪音具有相同的相位，噪音非但不会减弱，还会被放大。  
    计算主动降噪滤波器的理想值 一旦完成这三项测量，我们就能够用测量结果来计算 ANC 滤波器的理想值。所需的滤波器振幅计算如下：  
    FR(1)=FR(2)+FR(3)+FR(4)  
    所需滤波器的相位计算如下：  
    PH(1)+180°=PH(2)+PH(3)+PH(4)  
    计算结果能够很容易通过 Excel 表格得出，范例的频率响应及相位响应表明，仅使用一个全频宽的反相放大器是难以做出理想降噪信号的。

第二步：滤波器仿真，根据测试结果进行滤波器网络仿真

> 一个好的 ANC 耳机的关键在于滤波器的设计。如果滤波器的设计不合理，即使再好的 ANC 芯片也没用。滤波器设计的目标是尽量匹配增益和相位响应。在特定频率匹配得越好，ANC 性能也就越好。因为是模拟信号处理，滤波器的仿真通常是通过 spice 仿真工具完成的。  
> ANC 滤波器设计工程师的目的是滤波器仿真线路中的增益和相位响应与计算出的理想曲线匹配起来。现在人们使用的典型滤波器有一阶低通滤波器、陷波滤波器、高架及低架滤波器。设计师必须了解不同的拓扑结构以及截止频率、通带、阻带的计算方法。这当然不是一个简单的任务，尤其是当他们不习惯使用 spice 仿真工具和模拟滤波器开发工具时。  
> 为了解决这一问题，某些降噪芯片厂家开发评估软件整合了前馈滤波器仿真工具。设计工程师能够使用这一工具来设计理想的 ANC 滤波器。这一工具提供了一套预定义的滤波器架构，取代了修改零件值及滤波器结构的做法。基于为许多不同客户模拟的滤波器结构，这些预定义的滤波器结构能够涵盖 90% 的 ANC 声学需求。图 6 显示了该工具的模拟结果。绿色曲线代表理想的 ANC 增益和相位响应，蓝色曲线显示了利用图 5 的工具制作的 ANC 滤波器的模拟结果。设计滤波器时，有一点很重要，那就是我们要注重哪些频段。ANC 耳机的运作有特定的频率范围，这并非由于芯片本身的局限性，而是跟声音的传播速度及耳机的声学特性相关。如果我们只关注理想滤波曲线中的增益响应，设计符合该曲线的滤波器则很容易。但问题是在 ANC 滤波器的设计中也得同时匹配相位。由于更高频率下的相位几乎旋转了 180 度，设计出的滤波器很有可能与频率响应匹配，而不与相位匹配。取决于不同的耳机及其相位响应，我们通常可以做到 1.5kHz 频率以下的滤波器匹配。更高频的部分需要尽可能的衰减。如果不衰减这些未匹配的高频部分，可能会引入噪音。我们在低频部分减弱噪音，但如果高频的相位失配，就会导致噪音被放大。为了避免这一现象，我们会尽量在无法匹配的区域降低增益。高频衰减和相位响应之间必须达到一个良好的平衡。如果在高频下衰减得太多，会影响到低频的相位响应，从而可能失去 ANC 的效果。

```
   根据FF滤波器设计的原理，FB滤波器无需测试耳机的各个器件的及腔体参数，反馈麦克风采集到的信号，反向后即为FB滤波器的仿真参数，测试方法：通过耳机喇叭发声，反馈麦克风采集，软件直接进行反馈滤波器仿真；

```

第三步：进行降噪效果测试  
得到令人满意的滤波曲线以后，滤波器仿真工具同时提供材料清单输出功能。由于该工具和芯片的评估板相匹配，材料清单中列出的项目能够被焊接在评估板上，以测试带有该滤波器的 ANC 的性能。  
测试包含两项内容：一是耳机戴在人工头上时的被动降噪测试，二是打开芯片并配置好前馈降噪功能时的频响测试。  
测试方法：前提 1、需要手动或者指令开关耳机 ANC 功能 / 2、测试前进行噪声校准：对应裸耳采集，进行 0dB 的参考显示（噪声校准频响曲线归一化（0），被动曲线和 ANC 曲线都会减去噪声校准的频响）  
测试步骤：手动关闭 ANC 测试被动曲线，手动打开 ANC 后测试 ANC 曲线；