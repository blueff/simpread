> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [blog.csdn.net](https://blog.csdn.net/qq_38708943/article/details/109372553)

RAM 的 Parity 与 ECC
------------------

**一、概念介绍**  
**1.1 Parity 的概念**  
Parity，即奇偶校验位，指在数据存储和传输中，字节中额外增加一个比特位，用来检验错误。它常常是从两个或更多的原始数据中产生一个[冗余](https://so.csdn.net/so/search?q=%E5%86%97%E4%BD%99&spm=1001.2101.3001.7020)数据。一个字节数据的校验位等于 8bit 数据异或即：p=x0x1x2x3x4x5x6^x7。此时，实际的数据传输序列为 9bit：数据 + 奇偶校验位。  
Parity 这个概念可能最初接触到可能是在使用[串口](https://so.csdn.net/so/search?q=%E4%B8%B2%E5%8F%A3&spm=1001.2101.3001.7020)调试助手时，它有个可选的奇偶校验，就是为了指示数据传输过程中，发送方和接受方数据序列 1 的个数是否一致。如果不一致，说明数据在传输的链路中可能出错了。  
_**优点：**_  
结构简单，只需异或计算就可以实现，数据量小时（8 比特）实现代价小。  
_**缺点：**_  
1、不能修正错误：只知道校验的数据中有部分比特发生错误，无法判断哪几个比特发送错误。  
2、有偶数个比特位时，则无法判断出错。  
3、数据位宽较大时实现代价大：如 1024 比特数据，需要 256bit 的校验位。  
**1.2 ECC 的概念**  
ECC 是 “Error Correcting Code” 的简写，ECC 是一种能够实现 “错误检查和纠正” 的技术。通过上面的分析我们知道 Parity 机制是通过在原来数据位的基础上增加一个数据位来检查当前 8 位数据的正确性，随着数据位每增加 8 比特，检验位需要增加 1 比特。当数据量为 256 字节时，需要 256 个比特位，并且出错的数据无法恢复。由此，一种存储检错纠错机制出现了，这就是 ECC。ECC 同样通过增加校验位来进行错误判断，但是能够进行错误纠正。  
_**优点：**_  
1）：大量数据位实现代价低：8 比特数据需要 5 个校验位，256 字节（256*8 比特）的数据值需要 5 个列校验位和 11 行校验位  
2）能够纠正错误：在内存中 ECC 能够容许错误，并可以将错误更正，使系统得以持续正常的操作，不致因错误而中断  
_**缺点：**_  
1）：只能修复 1 比特错误  
当数据只有单比特错误时，ECC 能够进行错误修复；超过 2 比特的数据错误，将无法修复，ECC 只能输出多比特错误信号。  
2）：不保证能检测超过 2 比特的错误。  
超过 2 比特的错误不一定能检测出来。  
3）：逻辑复杂，逻辑级数比较深，时序不好收敛。

**二、应用场景**  
在 IC 设计中 RAM 模块需要输出信号有 Parity 信号和 ECC 信号。这样能够在一定程度上确保芯片的可测性以及可靠性。特别是在逻辑设计中使用的链表 RAM 或者控制 RAM，如果这类 RAM 底层有坏块而导致 RAM 读出的数据某 bit 发生错误，可能会导致系统挂死。为了减少出现这种情况的风险，一般会对这类 RAM 做 ECC 计算逻辑，而像数据流 RAM 或者配置 RAM 可以只做 Parity 校验。  
事实上，在做 Parity 计算时，并不需要严格按照每字节增加 1bit Parity 校验位，这样对于大位宽的 RAM 而言，仅仅为了实现校验错误，实现代价太大。因此，可以一个 RAM 做一个 Parity 校验位。而对于 ECC 而言，一般针对位宽较小的 RAM。  
Parity 是同一个 data 所有比特的异或，在 data_in 写入的时候进行异或计算得到 parity_in，同时写入到 RAM 中，读出 data 的得到 data_out，对 data_out 进行异或计算得到 parity_out，若 parity_out 与 parity_in（ram 读出数据所携带）不相等，则表示数据有错误。  
此外，在 RAM 的写侧和读侧加入 Parity 计算逻辑时，特别是大位宽的 RAM，则需要考虑 reg2mem 和 mem2reg 时序是否收敛的问题，一般情况下处理是写侧计算 Parity 后打拍后写入，读侧打拍后再做 parity 计算逻辑。

ECC 负责纠错，能够修正 1bit 的数据。算法比较复杂，可以参考以下博客，不在叙述。

参考博客：https://blog.csdn.net/wzsalan/article/details/79842220  
参考博客：https://blog.csdn.net/icxiaoge/article/details/79996456

_《获取更多资源，关注微信公众号：FPGA 自习室》_  
[RAM 的 Parity 与 ECC](https://mp.weixin.qq.com/s?__biz=MzU2MTc2ODgyNg==&mid=2247483894&idx=1&sn=d67d68b7fbef4f15abc5709c01e892e5&chksm=fc72f1e3cb0578f5017df73306250926d83a6f0225a2e9da00d4ab3b3792064abff87abeefea&token=620798565&lang=zh_CN#rd)